# Configuration Apache pour les sermons
# Types MIME pour les fichiers vidéo et sous-titres

# HLS (HTTP Live Streaming)
AddType application/vnd.apple.mpegurl .m3u8
AddType video/mp2t .ts

# Vidéos
AddType video/mp4 .mp4
AddType video/webm .webm
AddType video/ogg .ogv

# Sous-titres
AddType text/vtt .vtt
AddType application/x-subrip .srt

# Images
AddType image/jpeg .jpg .jpeg
AddType image/png .png
AddType image/webp .webp

# Activer les Range Requests pour la reprise de lecture
Header set Accept-Ranges bytes

# Cache pour les segments HLS (1 jour)
<FilesMatch "\.(ts)$">
    Header set Cache-Control "public, max-age=86400"
</FilesMatch>

# Cache pour les playlists HLS (1 heure)
<FilesMatch "\.(m3u8)$">
    Header set Cache-Control "public, max-age=3600"
</FilesMatch>

# Cache pour les vidéos MP4 (1 jour)
<FilesMatch "\.(mp4)$">
    Header set Cache-Control "public, max-age=86400"
</FilesMatch>

# Cache pour les sous-titres (1 heure)
<FilesMatch "\.(vtt)$">
    Header set Cache-Control "public, max-age=3600"
</FilesMatch>

# Cache pour les images (1 semaine)
<FilesMatch "\.(jpg|jpeg|png|webp)$">
    Header set Cache-Control "public, max-age=604800"
</FilesMatch>

# Compression GZIP
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
    AddOutputFilterByType DEFLATE application/json
    AddOutputFilterByType DEFLATE text/vtt
</IfModule>

# CORS pour les fichiers multimédias
<IfModule mod_headers.c>
    <FilesMatch "\.(m3u8|ts|mp4|vtt)$">
        Header set Access-Control-Allow-Origin "*"
        Header set Access-Control-Allow-Methods "GET, HEAD, OPTIONS"
        Header set Access-Control-Allow-Headers "Range"
    </FilesMatch>
</IfModule>
